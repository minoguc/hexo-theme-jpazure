<!-- Published / Last update -->
/ Last update: <a id="update-time" class="<%= class_name %>"></a><br>
Contributors: <ul style="display: inline-block; list-style:none" id="contributors" class="github-contributors"> </ul>

<script type="text/javascript">
  const sourceUrl = "<%- source_url %>";
  const urlParts = sourceUrl.split("/");
  const user = urlParts[3];
  const repo = urlParts[4];
  const filePath = urlParts.slice(7).join("/");
  const apiUrl = `https://api.github.com/repos/${user}/${repo}/commits?path=${filePath}`;

  function formatDate(date) {
    let year = date.getFullYear();
    let month = date.getMonth() + 1;
    let day = date.getDate();
    if (month < 10) month = '0' + month;
    if (day < 10) day = '0' + day;
    return `${year}-${month}-${day}`;
  }

  $.getJSON(apiUrl, function (data) {
    if (!data || data.length === 0) return;
    const commit = data[0];
    const updateDate = new Date(commit.commit.author.date);
    const localDate = formatDate(updateDate);
    const contributors = new Map();

    data.reverse().forEach(function (commit) {
      if (commit.author) {
        const name = commit.author.login;
        const url = commit.author.html_url;
        contributors.set(name, { name, url });
      }
    });

    $("#update-time").text(localDate);

    const contributorLinks = Array.from(contributors.values())
      .reverse()
      .map(c => `<a href="${c.url}" target="_blank" style="color: inherit; text-decoration: none;">${c.name}</a>`)
      .join(", ");

    $("#contributors").html(contributorLinks);
  });
</script>